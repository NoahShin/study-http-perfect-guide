#  다이제스트 인증
기본 인증은 편리하고 유연하지만 안전하지 않을 수 있다. 사용자 이름과 비밀번호를 평문으로 보내고 메시지를 위조하지 못하게 보호하려는 어떠한 시도도 하지 않는다. 기본 보안을 안전하게 이용하는 유일한 방법은 SSL과 결합해서 사용하는 것이다.

다이제스트 인증은 기본 인증과 호환되는 안전한 대체재로 개발되었지만 널리 쓰이지는 않는다. 다이제스트 인증이 가능한 가장 안전한 프로토콜은 아니다. 안전한 트랜잭션을 위한 많은 요구사항을 만족하지 못한다. 그러한 요구사항들에는 전송 계층 보안 (TLS)과 보안 HTTP (HTTPS)가 더 적합한 프로토콜이다.

# 다이제스트 인증의 개선점

- 비밀번호를 절대로 네트워크를 통해 평문으로 전송하지 않는다.
- 인증 체결을 가로채서 재현하려는 악의적인 사람들을 차단한다.
- 구현하기에 따라서 메시지 내용 위조를 막는 것도 가능하다.
- 그 외 몇몇 잘 알려진 형태의 공격을 막는다.
- 비밀번호를 안전하게 지키기 위해 요약 사용

- 다이제스트 인증은 절대로 비밀번호를 네트워크를 통해 보내지 않는다. 비밀번호를 보내는 대신 클라이언트는 비밀번호를 비가역적으로 뒤섞은 지문 혹은 요약(digest)을 보낸다.

## 단방향 요약

요약은 단방향 함수로 동작하고 일반적으로 입력 가능한 무한 가지의 모든 입력값들을 유한한 범위의 압축으로 변환한다. 비밀번호를 그대로 전송해야 할 문제로부터 해방시켜 준다.

## 재전송 방지를 위한 난스(nonce) 사용

악의적인 사람들은 비밀번호를 모른다 해도 요약을 가로채서 서버로 몇 번이고 재전송할 수 있다. 이러한 재전송 공격을 방지하기 위해 서버는 클라이언트에게 '난스'라고 하는 특별하고 자주 바뀌는 증표를 건네준다.

## 다이제스트 인증 핸스셰이크

다이제스트 인증 프로토콜은 기본 인증의 기존 헤더에 몇몇 새 옵션이 추가되었다. 선택적인 헤더인 Authorization-Info가 새로 추가되었다.






![](https://images.velog.io/images/noahshin__11/post/21727a5e-850b-4987-a55c-7734637edfe1/image.png)



1. 서버는 난스 값을 계산
2. 서버는 난스를 WWW-Authenticate (인증요구) 메시지에 담아 클라이언트에게 전송
3. 클라이언트는 알고리즘을 선택, 비밀번호와 그 외 데이터에 대한 요약을 계산
4. 클라이언트는 Authorization(응답) 메시지에 요약을 담아 서버에게 전송
5. 서버는 요약을 검증, rspauth 요약을 생성, 다음번 난스를 생성
6. 서버가 다음번 난스를 보냄, 클라이언트 rspauth 요약을 보냄 (Authentication-Info 정보)
7. 클라이언트가 rspauth 요약을 검증

# 실제 상황에 대한 고려
 

다이제스트 인증 작업을 할 때 고려해야 할 것 이 몇 가지 있다.

- 다중 인증요구 - 서버는 한 리소스에 대해 여러 인증을 요구 할 수 있다.
- 오류 처리 - 인증이 적절하지 않았을 때는 400 Bad Request를 반환하며, 로그로 기록하는것이 좋다.
- 보호 공간(Protection Space) - 기본인증에서, 클라이언트는 요청 URL와 그 하위의 모든 경로는 같은 보호 공간에 있는 것으로 가정한다.
- URL 다시 쓰기 - 프락시는 가리키는 리소스의 변경 없이 구문만 고쳐서 URL을 다시 쓰기도 한다. 다이제스트 인증은 이러한 변경으로 실패할 수 있다.
- 캐시 - 어떤 공유 캐시가 Authotization 헤더를 포함한 요청과 그에 대해 응답을 받은 경우, 두 Cache-Control 지시자 중 하나가 응답에 존재하지 않는 다른 요청에 대해 그 응답을 반환해서는 안된다.


# 보안에 대한 고려사항


- 헤더 부당 변경
- 재전송 공격 - 재전송 공격을 완전히 피할 수 있는 한 방법은 매 트랜잭션마다 유일한 난스 값을 사용하는 것이다
- 다중 인증 메커니즘 - 클라이언트가 언제나 가능한 한 가장 강력한 인증 제도를 선택하도록 해야 한다
- 사전(dictionary) 공격 - 크래킹하기 어렵도록 상대적으로 복잡한 비밀번호를 사용한다
- 악의적인 프락시와 중간자 공격(Man-in-the-Middle Attack) - SSL을 사용한다
- 선택 평문 공격 - 클라이언트가 서버에서 제공된 난스 대신 선택적인 c난스 지시자를 사용하여 응답을 생성할 수 있도록 한다.
- 비밀번호 저장 - 영역 이름이 유일함을 보장하며, 비밀번호 파일이 유출되더라도 피해를 특정 영역으로 국소화한다.




















